name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build:
    name: Build and Lint
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20.x'
        cache: 'npm'
    
    - name: Install Dependencies
      run: |
        # Install root dependencies
        npm ci
        
        # Install server dependencies
        cd server
        npm ci
        
        # Install client dependencies
        cd ../client
        npm ci
        
        # Install TypeScript globally
        npm install -g typescript
    
    - name: Run Linter
      run: npx eslint . --ext .ts,.tsx --fix --config eslint.config.js --max-warnings=0 || true
    
    - name: Build
      run: |
        cd client
        npm run build
  
  deploy:
    name: Deploy
    needs: build
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20.x'
    
    - name: Install Dependencies
      run: |
        npm ci
        cd server && npm ci
        cd ../client && npm ci
    
    - name: Build
      run: |
        cd client
        npm run build
    
    - name: Deploy to Production
      # Add your deployment steps here (e.g., Vercel, Netlify, etc.)
      run: |
        echo "Deployment would happen here"
        # Example: vercel --prod
